<div class="container">
  <div class="card border-0 shadow my-5" id="user-contain">
    <div class="card-body p-5">
      <h1 class="font-weight-light">Mon espace ðŸŒ¾</h1>
      <hr>

        <div class="col-lg-8 col-20 mx-auto">
          <div class="card my-3 card-people-4" id="card-info">
            <div class="card-header p-5 background-cover"  style="background-image:url('/assets/kiwi.jpeg')">
            </div>
            <div class="card-body p-relative font-title text-center">
              <h4 class="mt-4 uppercase"><%= current_user.first_name%> ðŸŒ±</h4>
              <div class="flex my-3">
                <div class="col-6 p-3"><p><%=current_user.appointments.length%></p><h6 class="my-1 font-body">Participations</h6><br>
                  <button type="button" class="btn btn-outline-secondary btn-rounded m-2" data-toggle="modal" data-target=".bd-participate-modal-xl">Voir</button>
                  <div class="modal fade bd-participate-modal-xl" tabindex="-1" role="dialog" aria-labelledby="myExtraLargeModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-xl">
                      <div class="modal-content">
                        <br>
                        <h4>Mes participations :</h4>
                     
                          <ul>
                            <% if current_user.appointments.length > 0%>
                            <% current_user.appointments.each do |appointment|%>
                              <li>Evenement : <%= appointment.id %>
                               <p>(Le <%= appointment.start_date %> | DurÃ©e : <%= appointment.duration %>)</p>
                              </li>
                             <%end%>
                            <%end%>
                          </ul>

                      </div>
                    </div>
                  </div>
                </div>
                  
                <div class="col-6 p-3"><p><%=current_user.created_events.length%></p><h6 class="my-1 font-body">Evenement organisÃ©s</h6><br>
                  <button type="button" class="btn btn-outline-secondary btn-rounded m-2" data-toggle="modal" data-target=".bd-event-modal-xl">Voir</button>
                  <div class="modal fade bd-event-modal-xl" tabindex="-1" role="dialog" aria-labelledby="myExtraLargeModalLabel" aria-hidden="true">
                  <div class="modal-dialog modal-xl">
                    <div class="modal-content">
                      <br>
                        <h4>Evenements organisÃ©s :</h4>

                          <% if current_user.created_events.length > 0%>
                          <% current_user.created_events.each do |event|%>
                            <h5 class="card-title"><%= event.id %></h5>
                            <p class="card-text">A partir de <%= event.start_date %> au <%= event.end_date %></p>
                          <%end%>
                          <% else %>
                            <p>Aucun Ã©vÃ¨nement organisÃ©</p>
                          <% end %> 
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

      <br>

      <h1 class="font-weight-light">Mon calendrier ðŸ—“</h1>
      <hr>
        <div class="calendar text-center">
          <%= month_calendar(attribute: :start_date, events: @events) do |date, events| %>
            <%= date.strftime('%d %b') %>
            <% events.each do |event| %>
            <div class="calendar-event">
              <%= date.strftime('%I:%M%P') %>
              <%= event.event_type.name %>
              <br>
            </div>
            <% end %>
          <% end %>
        </div>

      <br>
      
      <h1 class="font-weight-light">Mon calendrier ðŸ—“</h1>
      <hr>
        <div class="calendar text-center">
          <%= week_calendar(attribute: :start_date, events: @events, number_of_weeks: 2) do |date, events| %>
            <%= date.strftime('%d %b') %>
            <% events.each do |event| %>
            <div class="calendar-event">
              <%= event.appointments.count %>
              <%= date.strftime('%I:%M%P') %>
              <%= event.event_type.name %>
              <br>
            </div>
            <% end %>
          <% end %>
        </div>

    <style>

      /*event in day or week view*/
      .dhx_cal_event.collect_event div{
          background-color: #009966;
          color: #fff !important;
      }
      .dhx_cal_event.delivery_event div{
          background-color: blue !important;
          color: #fff !important;
      }

      .dhx_cal_event.cooking_event div{
          background-color: orange !important;
          color: #fff !important;
      }
  
      /*multi-day event in month view*/
      .dhx_cal_event_line.collect_event{
          background-color: #009966 !important;
          color: green !important;
      }
      .dhx_cal_event_line.delivery_event{
          background-color: #009966 !important;
          color: blue !important;
      }

      .dhx_cal_event_line.cooking_event{
          background-color: #009966 !important;
          color: orange !important;
      }

      /*event with fixed time, in month view*/
      .dhx_cal_event_clear.collect_event{
          color: green !important;
      }
      .dhx_cal_event_clear.delivery_event{
          color: blue !important;
      }

      .dhx_cal_event_clear.cooking_event{
          color: orange !important;
      }

    </style>

<div id='scheduler_here' class='dhx_cal_container' style='width:100%; height:800px;'>
  <div class='dhx_cal_navline'>
  <div class='dhx_cal_prev_button'>&nbsp;</div>
  <div class='dhx_cal_next_button'>&nbsp;</div>
  <div class='dhx_cal_today_button'></div>
  <div class='dhx_cal_date'></div>
  <div class='dhx_cal_tab' name='day_tab' style='right:204px;'></div>
  <div class='dhx_cal_tab' name='week_tab' style='right:140px;'></div>
  <div class='dhx_cal_tab' name='month_tab' style='right:76px;'></div></div>
  <div class='dhx_cal_header'></div>
  <div class='dhx_cal_data'></div>
  </div>
<script>
    scheduler.templates.event_class = function (start, end, event) {
        if (event.event_type.id == '1') 
            return "collect_event";
        else if (event.event_type.id == '2') 
            return "delivery_event";
        else 
            return "cooking_event";
    };
    // scheduler.config.icons_select = [
    //     "icon_details",
    //     "icon_location",
    //     "icon_edit",
    //     "icon_delete"
    // ];
    scheduler.config.lightbox.sections=[
        {name:"title", height:30, map_to:"text", type:"textarea" , focus:true},
        {name:"description", height:90, map_to:"description", type:"textarea"},
        // {name:"rue", height:30, map_to:"place", type:"textarea"},
        // {name:"code postal", height:30, map_to:"zip_code", type:"textarea"},
        // {name:"ville", height:30, map_to:"city", type:"textarea"},
        // {name:"quartier", height:30, map_to:"sector", type:"textarea"},
        { name:"type", height:21, inputWidth:400, map_to:"type", type:"select", 
            options:scheduler.serverList("options", [
                {key:1, label:"<%= EventType.first.name %>"},
                {key:2, label:"<%= EventType.find(2).name %>"},
                {key:3, label:"<%= EventType.find(3).name %>"}
            ]
        )},
        {name:"time", height:72, type:"time", map_to:"auto"}
    ];
 
scheduler.templates.event_text = scheduler.templates.event_bar_text = function(start, end, event){
    var options = scheduler.serverList("options");
 
    for(var i = 0; i < options.length; i++){
        if(options[i].key == event.type){
            return options[i].label;
        }
    }
 
    return "";
};
    scheduler.attachEvent("onTemplatesReady", function(){
        scheduler.templates.event_text=function(start,end,event){
            return "<b>" + event.id + " " + event.event_type.name + "<br>" + event.text + "</b><br><i>" + event.description + "</i>" + "</b><br><br>" + event.address.city + "<br>";
        }
        });
    scheduler.init('scheduler_here');
    scheduler.load('<%= data_admin_calendar_index_path %>', 'json');
    var dp = new dataProcessor('<%= db_action_admin_calendar_index_path %>');
    dp.init(scheduler);
    dp.setTransactionMode('GET', false);
</script>




    </div>
  </div>
</div>
