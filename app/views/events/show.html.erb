<body class="bg-event">
<div class="container">
<% require 'time' %>
  <div class="card border-0 shadow my-5" id="event">
  <div class="row">
  
    <div class="col-lg-8 col-sm-12">
      <br>

      <div class="card">

        <div class="card-header bg-white text-center">

          <h2><%=@event.title%>ğŸ’<h6><span class="badge badge-pill badge-info float-right"><%= @event.event_type.name %></span></h6></h2>

        </div>

        <div class="card-body">

          <img class="img-fluid rounded" src="https://images.pexels.com/photos/1301856/pexels-photo-1301856.jpeg?auto=compress&cs=tinysrgb&h=750&w=1260" alt="">
          <hr>
          <p><i>
          Le <%= @event.start_date.strftime("%-d %B %Y Ã  %Hh %M") %>
          </i></p>  
          <p class="lead"><%= @event.description %></p>        
          <p><%= @event.appointments.count%> <%= @event.appointments.count > 1 ? 'participants' : 'participant' %></p>
          
        </div>

        <div class="card-footer text-center bg-white">

          <!-- Appointment -->
          <%if current_user != @event.creator%>
          <% if user_signed_in? %>
            <% @appointment = @event.appointments.find { |appointment| appointment.user_id == current_user.id} %>   
            <% if @appointment != nil %>
              <%= link_to 'Je ne veux plus participer', event_appointment_path(@event.id, @appointment.id), method: :delete, class: 'btn btn-lg btn-warning ml-1 btn-rounded' %>  
            <% else %>
              <%= link_to 'Participer', new_event_appointment_path(@event.id), class: 'btn btn-lg btn-success m  l-1 btn-rounded' %>
            <% end %>
          <% else %>
            <%= link_to 'Connecte toi pour participer !', new_user_session_path, class: 'btn btn-lg btn-info btn-rounded' %>
          <% end %>
          <hr>
          <%else current_user == @event.creator%> 
            <%if @event.start_date > DateTime.now%> 
          <%= button_to 'Editer l\'Ã©vÃ¨nement', edit_event_path(@event.id), method: 'get', class: 'btn btn-lg btn-warning btn-rounded' %>
           <hr>
            <%else %>
              <%if @event.is_passed == false %>
          <%= button_to 'L\'Ã©vÃ¨nement est passÃ© - Demander les feedbacks ! ', {:controller => "events", :action => "update", :is_passed => true,}, method: 'patch', class: 'btn btn-lg btn-warning btn-rounded' %>
              <%else %>

            <% end %>
            <hr>
            <% end %>

          <% end %>
          
          <!-- Feedbacks -->
          <%= button_to 'Feedback', new_event_feedback_path(@event.id), method: 'get', class: 'btn btn-lg btn-secondary btn-rounded' %>

        </div>

      </div>

      <!-- Comments Form -->
      <div class="card my-4">
        <h5 class="card-header bg-white">Laisser un commentaire</h5>
        <div class="card-body">
          <%= render 'comments/form' %>
        </div>
      </div>

      <!-- Comment -->
      <% @event.comments.order('created_at DESC').each do |comment| %>
  
      <div class="media mb-4">

        <img class="d-flex mr-3 rounded-circle avatar" src="https://image.flaticon.com/icons/svg/145/145848.svg" alt="">
        <div class="media-body">
          <h5 class="mt-0"><%=  "#{comment.user.first_name}" " #{comment.user.last_name}"%></h5>
          <p><%= comment.text %></p>
          <%= comment.updated_at.strftime("%-d %B %Y, %Hh %M") %>
        </div>

        <% if comment.user == current_user %>
        <%= link_to 'Modifier', edit_comment_path(comment, comment: { text: comment.text, user_id: comment.user_id, event_id: comment.event_id }), class:"btn btn-sm bg-warning btn-rounded m-1" %>
        <% end %>
        <% if  current_user.is_admin == true %>
        <%= link_to 'Supprimer', comment, method: :delete, data: { confirm: 'Are you sure?' }, class:"btn btn-sm bg-danger btn-rounded m-1" %>
        <% end %>

      </div>

      <% end %>

      <br>

    </div>
    

    <div class="col-md-4">
      <br>

      <div class="card event-show-aside">
        <h5 class="card-header bg-white"> <strong><%= @event.title %></strong> ğŸ’ <span class="badge badge-pill badge-info float-right"><%= @event.event_type.name %></span></h5>
        <div class="card-body">
          <p><strong>CrÃ©Ã© par : </strong><%= @event.creator.first_name && @event.creator.last_name%></p>
          <p><strong>Secteur : </strong><%= @event.address.sector %>
          <p><strong>Date : </strong><%= @event.start_date.strftime("%-d %B %Y") %></p>
          <p><strong>Heure : </strong><%= @event.start_date.strftime("%Hh %M") %></p>
           <hr>
          <% if user_signed_in? %>
            <% @appointment = @event.appointments.find { |appointment| appointment.user_id == current_user.id} %>   
            <% if @appointment != nil %>
              <%= link_to 'Je ne veux plus participer', event_appointment_path(@event.id, @appointment.id), method: :delete, class: 'btn btn-md btn-danger ml-1 btn-rounded' %>  
            <% else %>
              <%= link_to 'Participer', new_event_appointment_path(@event.id), class: 'btn btn-md btn-success ml-1 btn-rounded' %>
            <% end %>
          <% else %>
            <%= link_to 'Connecte toi pour participer', new_user_session_path, class: 'btn btn-md btn-info ml-1 btn-rounded' %>
          <% end %>
        </div>
      </div>

    </div>

  </div>

</div>
</div>
</body>
